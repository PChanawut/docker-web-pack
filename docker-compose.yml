version: '2'
services:
  nginx:
    image: nginx
    container_name: lemp-nginx
    ports:
     - "80:80"
    volumes:
     - ./nginx/site:/usr/share/nginx/html
     - ./nginx/conf:/etc/nginx:ro
     - ./nginx/log:/var/log/nginx
    depends_on:
     - phpfpm
    networks:
      lemp-network:
        ipv4_address: ${LEMP_NGINX_IP}

  phpfpm:
    image: bitnami/php-fpm:latest
    container_name: lemp-phpfpm
    #ports:
    # - "9000:9000" 
    volumes:
    # - ./php-fpm/php-fpm.conf:/opt/bitnami/php/etc/php-fpm/php-fpm.conf
     - ./nginx/site:/usr/share/nginx/html
    networks:
      lemp-network:
        ipv4_address: ${LEMP_PHP7FPM}

  mysql-data:
    image: busybox
    container_name: lemp-mysql-data
    volumes:
     - ./mysql/storage:/var/lib/mysql

  mysql:
    image: mariadb
    container_name: lemp-mysql
    #ports:
    # - "3306:3306"
    volumes_from:
     - mysql-data
    volumes:
     - ./mysql/conf:/etc/mysql/conf.d
     - ./mysql/log:/var/log/mysql
    environment:
      MYSQL_ROOT_PASSWORD: 1212312121
    networks:
      lemp-network:
        ipv4_address: ${LEMP_MYSQL_IP}

networks:
  lemp-network:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: ${LEMP_SUBNET}
          gateway: ${LEMP_GATEWAY}
